# 单目视觉测距系统

基于 OpenCV 和相似三角形原理实现的单目视觉测距系统。

## 项目简介

本项目实现了基于单目摄像头的距离测量功能，使用相似三角形原理计算目标物体到摄像头的距离。

## 核心原理

### 相似三角形测距法

1. **焦距标定**：F = (P × D) / W  
   - F：摄像头焦距  
   - P：物体在图像中的像素宽度  
   - D：物体到摄像头的实际距离  
   - W：物体的实际宽度  

2. **距离计算**：D′ = (W × F) / P  
   - D′：待测距离  
   - W：已知物体实际宽度  
   - F：已标定的摄像头焦距  
   - P：物体在当前图像中的像素宽度  

## 功能模块

### 1．主测距系统（monocular_distance.py）
- 实时视频流处理  
- 自动目标检测和轮廓提取  
- 距离计算和显示  
- 支持多种图像处理算法  

### 2．焦距标定工具（focal_length_calibration.py）
- 交互式焦距标定  
- 支持手动测量和自动计算  
- 标定结果保存和加载  

### 3．距离演示工具（distance_demo.py）
- 模拟不同距离下的测量效果  
- 可视化距离变化  
- 测量精度分析  

### 4．统一入口程序（main.py）
- 菜单式操作界面  
- 集成所有功能模块  
- 用户友好的交互体验  

## 使用方法

### 环境要求
- Python 3.7+  
- OpenCV 4.x  
- NumPy  
- 摄像头设备  

### 安装依赖
```bash
pip install -r requirements.txt
```

### 运行程序
```bash
python main.py
```

### 操作步骤

1. **首次使用——焦距标定**：  
   - 选择“焦距标定工具”  
   - 将 A4 纸放置在已知距离处  
   - 按照提示完成标定  

2. **距离测量**：  
   - 选择“实时距离测量”  
   - 将目标物体放在摄像头前  
   - 系统自动检测并显示距离  

3. **效果演示**：  
   - 选择“距离演示工具”  
   - 查看不同距离下的测量效果  

## 技术特点

### 图像处理流程
1. **预处理**：灰度转换、高斯模糊  
2. **二值化**：自适应阈值处理  
3. **形态学操作**：膨胀、腐蚀去噪  
4. **轮廓检测**：查找目标物体轮廓  
5. **边界框计算**：获取物体像素尺寸  
6. **距离计算**：应用相似三角形公式  

### 优化特性
- 多种轮廓筛选条件  
- 实时性能优化  
- 错误处理和异常恢复  
- 用户友好的界面设计  

## 参数配置

### 关键参数说明
| 参数名 | 含义 | 默认值 |
| ------ | ---- | ------ |
| `foc` | 摄像头焦距（默认：2810.0） | 2810.0 |
| `real_wid` | 目标物体实际宽度（默认：11.69 英寸，A4 纸宽度） | 11.69 |
| `win_width/win_height` | 视频窗口尺寸 | 1920×1200 |
| `contour_area_threshold` | 轮廓面积阈值（默认：2000） | 2000 |

### 自定义配置
用户可根据实际使用环境调整以下参数：
- 摄像头分辨率  
- 目标物体尺寸  
- 检测阈值  
- 图像处理参数  

## 应用场景

- 工业测量和质量控制  
- 机器人导航和避障  
- 增强现实应用  
- 教学演示和科研实验  
- 智能监控系统  

## 注意事项

1. **光照条件**：确保充足且均匀的光照  
2. **目标物体**：使用对比度明显的矩形物体（如 A4 纸）  
3. **摄像头稳定**：避免摄像头抖动影响测量精度  
4. **标定精度**：焦距标定的准确性直接影响测量结果  
5. **距离范围**：测量精度在特定距离范围内最佳（建议 20–120 cm）  

## 扩展功能

### 可能的改进方向
- 支持多目标同时测距  
- 增加深度学习目标检测  
- 实现自动焦距标定  
- 添加测量历史记录  
- 支持不同形状物体测距  

## 技术参考

本项目基于以下技术文档和研究：
- OpenCV 官方文档  
- 计算机视觉相关论文  
- 相似三角形几何原理  
- 数字图像处理技术  

## 原文链接

[https://blog.csdn.net/qq_43010752/article/details/122320949](https://blog.csdn.net/qq_43010752/article/details/122320949)

---

**开发环境**：Python 3.x + OpenCV 4.x + NumPy  
**测试平台**：Ubuntu / Windows / macOS  
**许可证**：MIT License